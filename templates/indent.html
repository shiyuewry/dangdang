<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
{% load static %}
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>订单</title>
<script src="{% static 'js/jquery_1.8.js'%}js/jquery_1.8.js"></script>

	<link rel="shortcut icon" href="{% static 'images/favicon.ico?v=20160901' %}" type="image/x-icon">
    <link href="{% static 'css/shopping_cart_new.css' %}" rel="stylesheet" type="text/css">
	<link href="{% static 'css/footer_150526.css' %}" rel="stylesheet" type="text/css" />

<script src="{% static 'js/jquery.cookie.js' %}"></script>
<script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'js/jquery.js' %}"></script>
    <script src="{% static 'js/jquery1.4.2.js' %}"></script>
</head>

<body style="padding-bottom:82px">

<link href="{% static 'css/header_960_150611.css' %}" rel="stylesheet" type="text/css">
<script src="{% static 'js/pagetop2015_0827.js' %}" charset="gb2312" type="text/javascript"></script>

<div id="hd">
<div id="tools">
<div class="tools">
    <div class="ddnewhead_operate" dd_name="顶链接">
        {% if login %}
                <span id="nickname">{{ login }}<span class="hi hi_none">欢迎光临当当</span></span>
                <a href=" {% url 'loginregist:loginout' %}" class="login_link">登出</a>
            {% else %}

               <span class="hi hi_none">欢迎光临当当，请</span>
                <a href="{% url 'loginregist:login' %}" class="login_link">登录</a>
                <a href="{% url 'loginregist:regist' %}">免费注册</a></span>
            {% endif %}
        <div class="tel_pop" style="display:none" id="__ddnav_sjdd" onmouseover="showgaoji('a_phonechannel','__ddnav_sjdd');" onmouseout="hideotherchannel('a_phonechannel','__ddnav_sjdd');">
                <a target="_blank" href="http://t.dangdang.com/20130220_ydmr" class="title"><i class="icon_tel"></i>手机当当</a><i class="title_shadow"></i>
                <ul class="tel_pop_box">
                    <li><a href="http://t.dangdang.com/20130220_ydmr" dd_name="手机二维码"><span>当当手机客户端</span><img src="http://img3.ddimg.cn/00363/doc/erweima2.png"><span class="text">随手查订单<br>随时享优惠</span></a></li>
                </ul>
            </div>
        </div>
        <div class="new_head_znx" id="znx_content" style="display:none;"></div>
    </div>
</div>
</div>
<div id="header_end"></div>
<!--CreateDate  2016-09-28 11:30:01--></div>
<form action="http://search.dangdang.com/search.aspx" id="car_order" name="bootpagetopSearch" method="GET"></form>
<script type="text/javascript">var nick_num = 0;initHeaderOperate();</script><script type="text/javascript" src="http://orderb.dangdang.com/queryunpaid?callback=Unpaid_Data"></script>
		<div class="shoppingcart_wrapper" id="ad_cpt_11850"><div><a href="http://a.dangdang.com/tjump.php?q=ddo84XQOf357bOs8tXGg5%2F%2F0oVoDImt3DFWsMqu7ZMSVsfUMeOQJueASNiMLjq%2FdrXMLCKnVfyKEahteAh1ih%2ByKYrKGzhvL20LVbDzObRambBA0YPpivy5hR5foQ4Rt%2BTB" target="_blank" rel="nofollow"><img src="http://img62.ddimg.cn/2017/1/11/2017011111344969879.jpg"></a></div></div>
<div class="logo_line">
    <div class="w960">

        <div class="shopping_procedure01 shopping_procedure "><span>我的购物车</span><span class="current">填写订单</span><span>完成订单</span></div>
        <div class="logo"><a href="#"><img src="{% static 'images/bz_logo_car.jpg' %}" alt=""></a></div>
    </div>
</div>
<div class="indent_con">
	<div class="shdz">

    	<h3>收货相关信息</h3>
        <div class="address" id="dp_adress">
            <span class="icon_adr">&nbsp;</span>配送地址：
            <div class="select_add">
                <select name='add' id="sele" class="text fn-select-address" value="" onchange="addre(this.options[this.options.selectedIndex].id)">
                    <option value="">--请选择收货地址--</option>
                    {% for i in addr %}
                    <option value="{{ i.detail_address }}" id="{{ i.id }}">{{ i.detail_address }}</option>
                    {% endfor %}
                </select>
            </div>
            <!--<a href="#" class="tip"></a>-->
            <span class="tip_c" style="display:none;">针对不同配送地址，您的货物可能出现缺货或无货状态，敬请谅解。</span>
        </div>
        <form action="#" id="indentok">
            <ul class="shdz_con">
            <p>▪ 收货地址</p>
        	<li><label><strong>*</strong>收&nbsp;&nbsp;货&nbsp;&nbsp;人：</label><input type="text" name="ship_man" onblur="changename()" id="ship_man"><span id="spn_ship_man" class="hint new_tip" style="display: block;">请填写收货人姓名</span></li>
            <li><label><strong>*</strong>详细地址：</label><input type="text" name="ship_add" onblur="addr()" id="ship_add"><span id="spn_ship_add" class="hint new_tip" style="display: block;">请填写收货地址</span></li>
            <li><label><strong>*</strong>邮政编码：</label><input type="text" name="ship_zipcode"  onblur="zipcode()" id="ship_zipcode"><span id="spn_ship_zipcode" class="hint new_tip" style="display: block;">请填写邮编</span></li></li>
            <li><label><strong>*</strong>手&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;机：</label><input type="text" name="ship_phone" onblur="phonennum()" id="ship_phone"><label>或&nbsp;&nbsp;固定电话</label><input type="text" name="ship_tel" id="ship_tel"><span id="spn_ship_phone" class="hint new_tip" style="display: block;">请填写收货人手机号</span></li>
        </ul>
        </form>

        <div class="balance"><p>商品金额：¥{{ car.total_price }}</p><p class="yfze">应付总额（含运费）：<em>¥{{ car.total_price }}</em></p><p><a href="javascript:void(0)" onclick="orderOk()" onmouseover="move()">提交订单</a></p></div>
    </div>
    <script>
        flag1=false;
        flag2=false;
        flag3=false;
        flag4=false;
        function orderOk() {
            a = $('#ship_man').val();
            b = $('#ship_add').val();
            c = $('#ship_zipcode').val();
            d = $('#ship_tel').val();
            e = $('#ship_phone').val();
            counts = flag1+flag2+flag3+flag4;
            {#alert(counts);#}
            if (counts===4){
                $.ajax({
                type:'get',
                url:'{% url 'carapp:indentok2' %}',
                data:$('#indentok').serialize(),
                success:function (msg) {
                    if (msg === 'ok'){
                        location.href='{% url 'carapp:indentOk' %}'
                    }else{
                        alert('提交失败！！！')
                    }
                }
                 }
                )}

        }

{#        选择地址#}
        function addre(n) {
            if(n===''){
                $('#ship_man').val('');
                $('#ship_add').val('');
                $('#ship_zipcode').val('');
                $('#ship_tel').val('');
                $('#ship_phone').val('');

                $('#ship_man').removeAttr('disabled');
                $('#ship_add').removeAttr('disabled');
                $('#ship_zipcode').removeAttr('disabled');
                $('#ship_tel').removeAttr('disabled');
                $('#ship_phone').removeAttr('disabled');

                $('#spn_ship_man').text('收货人不能为空！');
                $('#spn_ship_add').html('地址不能为空');
                $('#spn_ship_zipcode').html('邮编不合法');
                $('#spn_ship_phone').html('手机号不合法');
            }else{
                $.ajax({
                type:'get',
                url:'{% url 'carapp:addr' %}',
                data:'id='+n,
                success:function (msg) {
                    $('#ship_man').val(msg.name);
                    $('#ship_add').val(msg.add);
                    $('#ship_zipcode').val(msg.zip);
                    $('#ship_tel').val(msg.telephone);
                    $('#ship_phone').val(msg.addr_mobile);

                    $('#ship_man').attr('disabled','disabled');
                    $('#ship_add').attr('disabled','disabled');
                    $('#ship_zipcode').attr('disabled','disabled');
                    $('#ship_tel').attr('disabled','disabled');
                    $('#ship_phone').attr('disabled','disabled');

                    flag1 = 1;
                    $('#spn_ship_man').text('');
                    flag2 = 1;
                    $('#spn_ship_add').text('');
                    flag3 = 1;
                    $('#spn_ship_zipcode').text('');
                    flag4 = 1;
                    $('#spn_ship_phone').text('');
            }
        })
            }
        }

        var Recpace = /\S/;
        var zip = /^\d{6}$/;
        var phone = /^[1][3,4,5,7,8][0-9]{9}$/;
        var telephone = /\d{3,4}[-]\d{8}/;
        function changename() {
            n = $('#ship_man').val();
            if (n===''){
                flag1 = 0;
                $('#spn_ship_man').text('收货人不能为空！');
                $('#spn_ship_man').css('color','red')
            }else{
                flag1 = 1;
                $('#spn_ship_man').text('');
            }
        }
        function addr() {
        var b = $('#ship_add').val();
        if (!Recpace.test(b)){
            flag2= 0;
            $('#spn_ship_add').html('地址不能为空')
        }else {
            flag2 = 1;
            $('#spn_ship_add').text('');
    }
    }

    function zipcode() {
        var c = $('#ship_zipcode').val();
        if (!zip.test(c)){
            flag3 = 0;
            $('#spn_ship_zipcode').html('邮编不合法')
        }else {
            flag3 = 1;
            $('#spn_ship_zipcode').text('');
    }
    }

    function phonennum() {
        var d = $('#ship_phone').val();
        if (!phone.test(d)){
            flag4 = 0;
            $('#spn_ship_phone').html('手机号不合法')
        }else {
            flag4 = 1;
            $('#spn_ship_phone').text('');
    }
    }
    </script>
    <div class="shdz">
    	<h3>订单1（百知网配送）</h3>
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tbody><tr style="height:30px; line-height:30px;">
                <th width="34%">商品名称</th>
                <th width="11%">所在仓库</th>
                <th width="13%">百知价</th>
                <th width="11%">促销价</th>
                <th width="9%">数量</th>
                <th width="11%">小计</th>
            </tr>
            
                {% for i in car.car_items %}
                    <tr>
                        <td align="center">{{ i.book.book_name }}</td>
                        <td align="center">{{ i.book.book_publish }}</td>
                        <td align="center">¥{{ i.book.book_dprice }}（{% widthratio i.book.book_dprice i.book.book_price 10 %}折）</td>
                        <td align="center">--</td>
                        <td align="center">{{ i.number }}</td>
                        <td align="center">¥{% widthratio i.book.book_dprice 1 i.number %}</td>

                       
                    </tr>
                {% endfor %}
                     <tr>
                        <td colspan="2"><input type="checkbox" >此订单作为礼品赠送他人</td>
                        <td colspan="2"><strong>运费：</strong>当确认送货方式后显示</td>
                        <td class="table_zj" colspan="3"><strong>小计总额：</strong><em>¥{{ car.total_price }}</em></td>
                    </tr>
                
            
                
            
        </tbody></table>
    </div>
     
</div>

<div id="footer">
<div class="footer">
	<div class="footer_nav_box">
		<div class="footer_copyright"><span>Copyright (C) 当当网 2004-2014, All Rights Reserved</span><a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001051000098" target="_blank" class="footer_img" rel="nofollow"><img src="http://img4.dangdang.com/bottom/validate.gif"></a><span><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP证041189号</a></span><span>出版物经营许可证&nbsp;新出发京批字第直0673号</span></div>
	</div>
</div>
</div>
    <div class="foot_tip_ad">广告</div>
    <style>
        .foot_tip_ad { width:40px; height:40px; font:12px/40px "simsun"; text-align:center; color:#fff; background-color:#474747; position:fixed; right:0; bottom:10px;_position:absolute; _bottom:auto;_top:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)));}
    </style>


</body>
</html>
